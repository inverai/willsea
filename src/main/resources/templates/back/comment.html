<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

	<head th:replace="back/header::head-fragment"></head>

		<body>
        <div th:replace="back/header::header-body"></div>
        <div style="position: absolute; left: 300px; width: 1000px; top: 100px">
			<div class="am-cf am-padding am-padding-bottom-0">
				<div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">评论管理</strong><small></small></div>
			</div>

			<hr>

			<div class="am-g">
				<div class="am-u-sm-12 am-u-md-6">
					<div class="am-btn-toolbar">
						<div class="am-btn-group am-btn-group-xs">
							<!--<button type="button" class="am-btn am-btn-default"><span class="am-icon-plus"></span> 新增</button>-->
						</div>
					</div>
				</div>
			</div>
			<div class="am-g">
				<div class="am-u-sm-12">
					<form class="am-form">
						<table class="am-table am-table-striped am-table-hover table-main">
							<thead>
								<tr>
									<th class="table-id">评论ID</th>
									<th class="table-id">心愿瓶ID</th>
									<th class="table-type">评论人ID</th>
									<th class="table-type">创建时间</th>
									<th class="table-type">内容</th>
									<th class="table-set">操作</th>
								</tr>
							</thead>
                                <tbody>
                                    <th:block th:each="node : ${comments}">
                                        <tr>
                                            <!--<td><th:block th:text="${node.cid}"/></td>-->
                                            <td><input type="text" name="cid" th:value="${node.cid}"></td>
                                            <td><th:block th:text="${node.bid}"/></td>
                                            <td><th:block th:text="${node.aid}"/></td>
                                            <td><th:block th:text="${node.ctime}"/></td>
                                            <td><input th:id="content+(${node.cid})" type="text" name="content" th:value="${node.content}"></td>
                                            <td>
                                                <div class="am-btn-toolbar">
                                                    <div class="am-btn-group am-btn-group-xs">
                                                        <a class="am-btn am-btn-default am-btn-xs am-text-secondary" href="javascript:void(0)" th:onclick="'savePost( ' + ${node.cid} + ');'"><span class="am-icon-pencil-square-o"></span> 保存</a>
                                                        <a class="am-btn am-btn-default am-btn-xs am-text-danger am-hide-sm-only" href="javascript:void(0)" th:onclick="'delPost(' + ${node.cid} + ');'"><span class="am-icon-trash-o"></span> 删除</a>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </th:block>
                                </tbody>
						</table>
						<div class="am-cf">
							<p>共<th:block th:text="${recordNum}"/>条记录</p>
							<div class="am-fr">
								<ul class="am-pagination">
									<li class="am-disabled">
										<a href="#">«</a>
									</li>
									<li class="am-active">
										<a href="#">1</a>
									</li>
									<li>
										<a href="#">2</a>
									</li>
									<li>
										<a href="#">3</a>
									</li>
									<li>
										<a href="#">4</a>
									</li>
									<li>
										<a href="#">5</a>
									</li>
									<li>
										<a href="#">»</a>
									</li>
								</ul>
							</div>
						</div>
						<hr>
					</form>
				</div>
			</div>
		</div>

        <script type="text/javascript">
            function delPost(cid) {
                $.ajax({
                    type: 'POST',
                    url: '/back/comment/delete',
                    data: {cid: cid},
                    dataType: 'json',
                    success: function(){
                        console.log("success");
                    },
                    error: function () {
                        console.log("failure");

                    }
                })
            }

            function savePost(cid) {
                var text = document.getElementById('content' + cid).value;

                $.ajax({
                    type: 'POST',
                    url: '/back/comment/save',
                    data: {
                        cid: cid,
                        content: text
                    },
                    dataType: 'json',
                    success: function (result) {
                        if(result && result.success){
                            console.log("文章保存成功");
                        } else{
                            console.log("文章保存失败");
                        }
                    },
                    error: function () {
                        console.log("POST执行回调函数失败");
                    }
                });
            }
        </script>
	</body>

</html>