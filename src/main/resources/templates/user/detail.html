<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link th:href="@{/admin/css/bootstrap.min.css}" rel="stylesheet">
<link th:href="@{/admin/css/vendor.css}" rel="stylesheet">
<link th:href="@{/admin/css/theme.css}" rel="stylesheet">
<link th:href="@{/admin/css/utility.css}" rel="stylesheet">
<link th:href="@{/admin/css/custom.css}" rel="stylesheet">
<link th:href="@{/admin/css/amazeui.min.css}" rel="stylesheet" />
<link th:href="@{/admin/css/admin.css}" rel="stylesheet/">
<script th:src="@{/admin/js/jquery-1.11.3.min.js}"></script>
<script th:src="@{/admin/myplugs/js/plugs.js}"></script>
<body>
<div style="position: absolute; left: 240px; width: 1260px; top: 60px">
    <form>
        <div class="form-group">
            <label for="exampleInputTitle">标题</label>
            <input type="text" class="form-control" id="exampleInputTitle" th:value="${bottle.getTitle()}">
        </div>
        <div class="form-group">
            <label for="exampleInputAuthor">作者</label>

            <input type="text" readonly="readonly" class="form-control" id="exampleInputAuthor" th:value="${username}">
            <button th:if="${cookieUser!=null}" class="btn btn-info favorite" style="display: inline; float: right;" th:onclick="'addToTypeList(' + ${bottle.getAid()} + ', \'favorite\');'">关注</button>
            <button th:if="${cookieUser!=null}" class="btn btn-info black" style="display: inline; float: right;" th:onclick="'addToTypeList('+  ${bottle.getAid()}+','+'\'black\'' + ');'">拉黑</button>
        </div>

        <div th:if="${bottle.getBtext() != 'NULL'}" class="form-group">
            <div>
                <label style="display: inline; float: left;" for="textPlayer">文本内容</label>
            </div>
            <textarea class="form-control" id="textPlayer" rows="2" readonly="readonly" th:text="${bottle.getBtext()}"></textarea>
        </div>

        <div th:if="${bottle.getBaudio()} != 'NULL'" class="form-group">
            <div>
                <label style="display: block" for="audioPlayer">音频内容</label>
                <button th:if="${cookieUser!=null && cookieUser.getUid()==bottle.getAid()}" class="btn btn-info" style="display: inline; float: right;" th:onclick="'deleteContent(' + ${bottle.getBid()} + ', \'audio\');'">删除</button>
            </div>
            <audio  th:src="${bottle.getBaudio()}" id="audioPlayer" controls="controls" loop="loop" preload="auto">浏览器不支持语音</audio>
            <!--<audio th:src="@{/user/audio/London.mp3}" id="audioPlayer" controls="controls" loop="loop" preload="auto">浏览器不支持语音</audio>-->
        </div>
        <div th:if="${bottle.getBvideo()} != 'NULL'" class="form-group">
            <div>
                <label style="display: block" for="videoPlayer">视频内容</label>
                <button th:if="${cookieUser!=null && cookieUser.getUid()==bottle.getAid()}" class="btn btn-info" style="display: inline; float: right" th:onclick="'deleteContent(' + ${bottle.getBid()} + ', \'video\');'">删除</button>
            </div>
            <video th:src="${bottle.getBvideo()}" id="videoPlayer" width="600" height="400" controls="controls" loop="loop">浏览器不支持视频</video>
        </div>
        <th:block th:each="node, nodeState : ${comments}">
            <div class="form-group">
                <div>
                    <label style="display: inline; float: left" th:for="textComment + ${node.cid}" th:text="'Comment: ' + ${nodeState.index} + ' , Author:' + ${authorNames.get(node.getCid())}"></label>
                    <button th:if="${cookieUser!=null && cookieUser.getUid()==node.getAid()}" class="btn btn-info" style="display: inline; float: right;" th:onclick="'deleteComment(' + ${node.getCid()} + ');'">删除</button>
                </div>
                <textarea class="form-control" th:id="textComment + ${node.cid}" th:text="${node.content}" rows="2" readonly="readonly"></textarea>
                <!-- 判断cache中的登录用户的与评论的id是否相等 如果相等添加删除按钮-->
            </div>

        </th:block>
    </form>
</div>
</body>
<script th:inline="javascript">
    function addToTypeList(uid,type)
    {
            console.log(uid);
            console.log(type);
            $.ajax({
                type: 'POST',
                url: '/user/detail/addToTypeList',
                data: {target:uid,type:type},
                dataTpye: 'json',
                success: function () {
                    if(type=="favorite")
                        document.getElementsByClassName(".favorite")[0].style.display="none";
                    else
                        document.getElementsByClassName(".black")[0].style.display="none";
                },
                error: function () {
                }
            });
    }
    function deleteComment(cid) {
        var bid = [[${bottle.getBid()}]];
        $.ajax({
            type: 'POST',
            url: '/back/comment/delete',
            data: {
                cid: cid,
                bid: bid
            },
            dataType: 'json',
            success: function () {
                console.log("delete successfully!");
                setTimeout(function (result) {
                    if(result && result['success']){
                        var data = result['data'];
                        window.location.href = '/back/wishbottle/detail/' + data;
                    } else{
                        console.log("failure in result");
                    }
                }, 500);
            },
            error: function () {
                console.log("failure in delete");
            }
        })
    }
    function deleteContent(bid, type) {
        $.ajax({
            type: 'POST',
            url: '/back/wishbottle/deleteContent',
            data: {
                bid: bid,
                type: type
            },
            dataType: 'json',
            success: function () {
                console.log("success");
                setTimeout(function () {
                    window.location.reload();
                }, 500);
            },
            error: function () {
                console.log("failure");
            }
        })
    }
</script>
</html>